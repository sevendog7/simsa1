<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심사결과 집계</title>
    <!-- Tailwind CSS 로딩 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 로딩 스피너 스타일 */
        .loader {
            border: 8px solid #f3f3f3;
            border-radius: 50%;
            border-top: 8px solid #3498db;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans p-4 sm:p-6 md:p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
        <header class="mb-6 pb-4 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800 text-center">심사결과 최종 집계</h1>
            <p class="text-center text-gray-500 mt-2">심사표 1번부터 9번까지의 합산 결과입니다.</p>
        </header>

        <!-- 데이터 로딩 시 보여줄 스피너 -->
        <div id="loading" class="flex flex-col items-center justify-center py-12">
            <div class="loader mb-4"></div>
            <p class="text-gray-600">데이터를 집계하는 중입니다...</p>
        </div>

        <!-- 결과 테이블 -->
        <div id="result-table-container" class="hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="py-3 px-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">연번</th>
                            <th class="py-3 px-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">합계</th>
                        </tr>
                    </thead>
                    <tbody id="summary-body" class="divide-y divide-gray-200">
                        <!-- 자바스크립트로 데이터가 채워질 부분 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const baseUrl = 'https://sevendog7.github.io/simsa1/';
            const totalFiles = 9;
            // Map: { 연번 => 총점 } 형태로 데이터를 저장합니다.
            const scores = new Map();

            // 로딩 UI를 먼저 보여줍니다.
            const loadingIndicator = document.getElementById('loading');
            const resultContainer = document.getElementById('result-table-container');

            try {
                // 여러 fetch 요청을 동시에 처리하기 위해 Promise 배열을 생성합니다.
                const fetchPromises = [];
                for (let i = 1; i <= totalFiles; i++) {
                    const url = `${baseUrl}simsapyo${i}.html`;
                    fetchPromises.push(
                        fetch(url)
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`${url} 파일을 불러오는 데 실패했습니다.`);
                                }
                                return response.text();
                            })
                    );
                }

                // 모든 HTML 파일 내용을 한 번에 가져옵니다.
                const htmlContents = await Promise.all(fetchPromises);

                // 가져온 HTML 내용을 순서대로 처리합니다.
                htmlContents.forEach(html => {
                    // 문자열 형태의 HTML을 DOM 객체로 파싱합니다.
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // 테이블의 모든 행(row)을 선택합니다. (헤더 제외)
                    const rows = doc.querySelectorAll('table tr:not(:first-child)');

                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        // 각 행에 7개의 셀이 있는지 확인합니다.
                        if (cells.length === 7) {
                            // 첫 번째 셀(연번)과 마지막 셀(합계)의 텍스트를 가져옵니다.
                            const serialNumber = parseInt(cells[0].textContent.trim(), 10);
                            const totalScore = parseFloat(cells[6].textContent.trim());

                            // 유효한 숫자인 경우에만 계산합니다.
                            if (!isNaN(serialNumber) && !isNaN(totalScore)) {
                                // 기존 점수에 새로운 점수를 더합니다.
                                const currentScore = scores.get(serialNumber) || 0;
                                scores.set(serialNumber, currentScore + totalScore);
                            }
                        }
                    });
                });

                // 집계가 끝나면 결과를 테이블에 표시합니다.
                displayResults();

            } catch (error) {
                // 에러 발생 시 메시지를 표시합니다.
                loadingIndicator.innerHTML = `<p class="text-red-500 font-semibold">데이터 집계 중 오류가 발생했습니다: ${error.message}</p>`;
                console.error('Error fetching or parsing data:', error);
            }

            function displayResults() {
                const tbody = document.getElementById('summary-body');
                tbody.innerHTML = ''; // 기존 내용을 비웁니다.

                // 연번을 기준으로 오름차순 정렬합니다.
                const sortedScores = new Map([...scores.entries()].sort((a, b) => a[0] - b[0]));

                // 정렬된 데이터를 테이블 행으로 만들어 추가합니다.
                sortedScores.forEach((total, serial) => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors duration-200';
                    
                    const serialCell = document.createElement('td');
                    serialCell.className = 'py-3 px-4 text-gray-700';
                    serialCell.textContent = serial;

                    const scoreCell = document.createElement('td');
                    scoreCell.className = 'py-3 px-4 text-gray-800 font-medium';
                    // 소수점 둘째 자리까지 표시합니다.
                    scoreCell.textContent = total.toFixed(2);

                    row.appendChild(serialCell);
                    row.appendChild(scoreCell);
                    tbody.appendChild(row);
                });

                // 로딩 스피너를 숨기고 결과 테이블을 보여줍니다.
                loadingIndicator.classList.add('hidden');
                resultContainer.classList.remove('hidden');
            }
        });
    </script>

</body>
</html>
