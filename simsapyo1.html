<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>적극행정 우수사례 2차 심사표 집계</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        @media print {
            body { background-color: #fff; margin: 0; padding: 0; }
            .max-w-7xl { max-width: none; box-shadow: none; padding: 0; }
            .no-print { display: none; }
            table { font-size: 8pt; table-layout: fixed; }
            th, td { padding: 2px 1px; }
            h1, h2 { font-size: 1rem; }
            .main-table th { background-color: #d1e2f7; }
            .main-table td input { border: none; text-align: center; }
            .main-table td:nth-child(2) input { text-align: left; }
            .signature-box { display: flex; justify-content: flex-end; margin-top: 10px; }
            .signature-item { margin-left: 20px; }
            .signature-item input { border: none; border-bottom: 1px solid #000; width: 80px; text-align: center; }
            .reference-table th, .reference-table td { font-size: 6pt; }
            .reference-table th { background-color: #e0e0e0; }
            .reference-table td, .reference-table th { vertical-align: middle; }
            .reference-table ul { text-align: left; padding: 0 0 0 10px; list-style-type: disc; }
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-7xl mx-auto bg-white shadow-xl rounded-2xl p-8 relative">
        <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">적극행정 우수사례 2차 심사표 (개인별)</h1>
        
        <div class="absolute top-8 right-8 flex space-x-4 no-print">
            <button id="complete-button" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
                입력완료 (저장)
            </button>
            <button id="print-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
                출력 (MS Word)
            </button>
        </div>

        <div class="overflow-x-auto rounded-xl mb-8">
            <table class="w-full text-sm text-left text-gray-700 rounded-xl overflow-hidden">
                <thead class="text-xs text-white uppercase bg-blue-600">
                    <tr>
                        <th scope="col" class="px-3 py-2 text-center">연번</th>
                        <th scope="col" class="px-3 py-2 text-center">사례명</th>
                        <th scope="col" class="px-3 py-2 text-center">국민<br>체감도 (20)</th>
                        <th scope="col" class="px-3 py-2 text-center">적극성<br>및 창의성 (30)</th>
                        <th scope="col" class="px-3 py-2 text-center">중요도 및<br>난이도 (30)</th>
                        <th scope="col" class="px-3 py-2 text-center">확산<br>가능성 (10)</th>
                        <th scope="col" class="px-3 py-2 text-center">국민<br>호응도 (10)</th>
                        <th scope="col" class="px-3 py-2 text-center font-bold">합계 (100)</th>
                    </tr>
                </thead>
                <tbody id="score-table-body" class="bg-white divide-y divide-gray-200">
                </tbody>
            </table>
        </div>

        <div class="flex flex-col sm:flex-row justify-end items-center space-y-4 sm:space-y-0 sm:space-x-8 mt-8">
            <div class="flex items-center space-x-2">
                <label for="judge-name" class="text-gray-700 font-semibold">작성자(심사위원):</label>
                <div class="flex items-center p-2 border-b border-gray-300">
                    <input type="text" id="judge-name" class="p-1 w-32 focus:outline-none bg-white">
                    <span class="ml-2 font-bold">(인)</span>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <label for="chair-name" class="text-gray-700 font-semibold">확인자(위원장):</label>
                <div class="flex items-center p-2 border-b border-gray-300">
                    <input type="text" id="chair-name" class="p-1 w-32 focus:outline-none bg-white">
                    <span class="ml-2 font-bold">(인)</span>
                </div>
            </div>
        </div>
        
        <div class="mt-12 overflow-x-auto rounded-xl">
            <h2 class="text-2xl font-bold text-center text-blue-700 mb-4">심사내용 배점기준표</h2>
            <table class="w-full text-sm text-center text-gray-700 rounded-xl overflow-hidden border border-gray-300">
                <thead class="text-xs text-white uppercase bg-gray-500">
                    <tr><th scope="col" class="px-3 py-2 border-r border-gray-400">심사항목</th><th scope="col" class="px-3 py-2 border-r border-gray-400">심사내용</th><th scope="col" class="px-3 py-2 border-r border-gray-400">배점</th><th scope="col" class="px-3 py-2">매우 우수</th><th scope="col" class="px-3 py-2">우수</th><th scope="col" class="px-3 py-2">보통</th><th scope="col" class="px-3 py-2">미흡</th><th scope="col" class="px-3 py-2">매우 미흡</th></tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr class="hover:bg-gray-50 transition-colors duration-200"><td class="px-3 py-2 border-r border-gray-300 font-semibold" rowspan="1">국민체감도</td><td class="px-3 py-2 border-r border-gray-300 text-left"><ul class="list-disc list-inside space-y-1"><li>국민 생활편의 및 만족도를 제고하거나 국가재정 절감에 기여하는 등 국민이 체감할 수 있는 변화 정도를 평가</li></ul></td><td class="px-3 py-2 border-r border-gray-300">20</td><td class="px-3 py-2">20-18</td><td class="px-3 py-2">17-14</td><td class="px-3 py-2">13~10</td><td class="px-3 py-2">9~6</td><td class="px-3 py-2">5~</td></tr>
                    <tr class="hover:bg-gray-50 transition-colors duration-200"><td class="px-3 py-2 border-r border-gray-300 font-semibold">적극성<br>창의성<br>전문성</td><td class="px-3 py-2 border-r border-gray-300 text-left"><ul class="list-disc list-inside space-y-1"><li>새로운 정책 발굴, 이해 조정 및 협업 등 문제해결을 위해 적극적으로 노력한 정도를 평가</li><li>해당 과제를 새로운 관점에서 효과적으로 해결하거나 전문지식 경험 등을 활용한 정도를 평가</li></ul></td><td class="px-3 py-2 border-r border-gray-300">30</td><td class="px-3 py-2">30-25</td><td class="px-3 py-2">24-19</td><td class="px-3 py-2">18-13</td><td class="px-3 py-2">12-7</td><td class="px-3 py-2">6-</td></tr>
                    <tr class="hover:bg-gray-50 transition-colors duration-200"><td class="px-3 py-2 border-r border-gray-300 font-semibold">중요도 및<br>난이도</td><td class="px-3 py-2 border-r border-gray-300 text-left"><ul class="list-disc list-inside space-y-1"><li>국가 전반의 경쟁력을 제고하는데 도움이 되는 정도</li><li>관련 업무나 민원요구를 해결하기 어려운 정도 또는 열악한 정책 환경 등을 평가</li></ul></td><td class="px-3 py-2 border-r border-gray-300">30</td><td class="px-3 py-2">30-25</td><td class="px-3 py-2">24-19</td><td class="px-3 py-2">18-13</td><td class="px-3 py-2">12-7</td><td class="px-3 py-2">6-</td></tr>
                    <tr class="hover:bg-gray-50 transition-colors duration-200"><td class="px-3 py-2 border-r border-gray-300 font-semibold">확산 가능성</td><td class="px-3 py-2 border-r border-gray-300 text-left"><ul class="list-disc list-inside space-y-1"><li>동 사례에서 나타난 적극행정 노력이 타 기관으로 확산될 가능성이 있는지를 평가</li></ul></td><td class="px-3 py-2 border-r border-gray-300">10</td><td class="px-3 py-2">10-9</td><td class="px-3 py-2">8-7</td><td class="px-3 py-2">6-5</td><td class="px-3 py-2">4-3</td><td class="px-3 py-2">2-</td></tr>
                </tbody>
            </table>
            <table class="w-full text-sm text-center text-gray-700 rounded-xl overflow-hidden border border-gray-300 mt-8">
                <thead class="text-xs text-white uppercase bg-gray-500">
                    <tr><th scope="col" class="px-3 py-2 border-r border-gray-400">심사항목</th><th scope="col" class="px-3 py-2 border-r border-gray-400">심사내용</th><th scope="col" class="px-3 py-2 border-r border-gray-400">배점</th><th scope="col" class="px-3 py-2">1위</th><th scope="col" class="px-3 py-2">2위</th><th scope="col" class="px-3 py-2">3위</th><th scope="col" class="px-3 py-2">4위</th><th scope="col" class="px-3 py-2">5위</th><th scope="col" class="px-3 py-2">6위 이하</th></tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr class="hover:bg-gray-50 transition-colors duration-200"><td class="px-3 py-2 border-r border-gray-300 font-semibold">국민호응도</td><td class="px-3 py-2 border-r border-gray-300 text-left"><ul class="list-disc list-inside space-y-1"><li>온라인 국민투표 결과(1위~6위 이하 순위별 배점)</li></ul></td><td class="px-3 py-2 border-r border-gray-300">10</td><td class="px-3 py-2">10</td><td class="px-3 py-2">9</td><td class="px-3 py-2">8</td><td class="px-3 py-2">7</td><td class="px-3 py-2">6</td><td class="px-3 py-2">5</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tableBody = document.getElementById('score-table-body');
            const numRows = 10;
            const storageKey = 'activeAdminEvaluationData'; // 로컬 저장소 키

            // 1. 테이블 행 동적 생성
            for (let i = 1; i <= numRows; i++) {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors duration-200';
                row.innerHTML = `
                    <td class="px-3 py-2 text-center text-gray-900 font-medium">${i}</td>
                    <td class="px-3 py-2"><input type="text" id="case-${i}-name" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-400 transition duration-300 text-sm"></td>
                    <td class="px-3 py-2 text-center"><input type="number" data-score-for="case-${i}" data-max="20" class="score-input w-20 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-400 text-center transition duration-300 text-sm"></td>
                    <td class="px-3 py-2 text-center"><input type="number" data-score-for="case-${i}" data-max="30" class="score-input w-20 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-400 text-center transition duration-300 text-sm"></td>
                    <td class="px-3 py-2 text-center"><input type="number" data-score-for="case-${i}" data-max="30" class="score-input w-20 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-400 text-center transition duration-300 text-sm"></td>
                    <td class="px-3 py-2 text-center"><input type="number" data-score-for="case-${i}" data-max="10" class="score-input w-20 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-400 text-center transition duration-300 text-sm"></td>
                    <td class="px-3 py-2 text-center"><input type="number" data-score-for="case-${i}" data-max="10" class="score-input w-20 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-400 text-center transition duration-300 text-sm"></td>
                    <td class="px-3 py-2 text-center font-bold text-lg text-blue-700" id="total-case-${i}">0</td>
                `;
                tableBody.appendChild(row);
            }

            // 2. 합계 계산 함수
            function calculateTotal(caseId) {
                const scoreInputs = document.querySelectorAll(`[data-score-for="${caseId}"]`);
                let total = 0;
                scoreInputs.forEach(input => {
                    input.value = input.value.split('.')[0];
                    const value = parseInt(input.value) || 0;
                    const max = parseInt(input.dataset.max);
                    if (value > max) { input.value = max; }
                    else if (value < 0) { input.value = 0; }
                    total += parseInt(input.value) || 0;
                });
                document.getElementById(`total-${caseId}`).innerText = total;
            }
            
            // 3. 모든 점수 입력칸에 이벤트 리스너 추가
            const scoreInputs = document.querySelectorAll('.score-input');
            scoreInputs.forEach(input => {
                input.addEventListener('input', (event) => {
                    const caseId = event.target.dataset.scoreFor;
                    calculateTotal(caseId);
                    if (event.target.value.length > 1 && event.target.value.startsWith('0') && event.target.value !== '0') {
                        event.target.value = parseInt(event.target.value, 10);
                    }
                });
            });

            // [추가] 4. 데이터 저장 함수
            function saveData() {
                const dataToSave = {
                    judgeName: document.getElementById('judge-name').value,
                    chairName: document.getElementById('chair-name').value,
                    cases: []
                };

                for (let i = 1; i <= numRows; i++) {
                    const caseName = document.getElementById(`case-${i}-name`).value;
                    const scores = Array.from(document.querySelectorAll(`[data-score-for="case-${i}"]`)).map(input => input.value);
                    dataToSave.cases.push({ name: caseName, scores: scores });
                }

                localStorage.setItem(storageKey, JSON.stringify(dataToSave));
                alert('입력 내용이 성공적으로 저장되었습니다.');
            }

            // [추가] 5. 데이터 불러오기 함수
            function loadData() {
                const savedData = localStorage.getItem(storageKey);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    document.getElementById('judge-name').value = data.judgeName || '';
                    document.getElementById('chair-name').value = data.chairName || '';
                    
                    data.cases.forEach((caseData, index) => {
                        const i = index + 1;
                        document.getElementById(`case-${i}-name`).value = caseData.name;
                        const scoreInputsForRow = document.querySelectorAll(`[data-score-for="case-${i}"]`);
                        scoreInputsForRow.forEach((input, scoreIndex) => {
                            input.value = caseData.scores[scoreIndex] || '';
                        });
                        calculateTotal(`case-${i}`); // 저장된 값으로 합계 재계산
                    });
                }
            }
            
            // [변경] 6. '입력완료' 버튼 기능 (저장)
            document.getElementById('complete-button').addEventListener('click', saveData);

            // [변경] 7. 출력 버튼 기능 (Word 파일 서식 수정)
            document.getElementById('print-button').addEventListener('click', () => {
                const judgeName = document.getElementById('judge-name').value;
                const chairName = document.getElementById('chair-name').value;
                let tableHtml = '';
                document.querySelectorAll('#score-table-body tr').forEach(row => {
                    const caseNumber = row.querySelector('td').innerText;
                    const caseName = row.querySelector(`#case-${caseNumber}-name`).value;
                    const scores = Array.from(row.querySelectorAll('.score-input')).map(input => input.value || '0');
                    const totalScore = row.querySelector('.text-lg').innerText;
                    
                    // 점수가 있거나 사례명이 입력된 행만 출력
                    if (parseInt(totalScore) > 0 || caseName.trim() !== '') {
                        tableHtml += `<tr><td>${caseNumber}</td><td style="text-align:left; padding-left:5px;">${caseName}</td><td>${scores[0]}</td><td>${scores[1]}</td><td>${scores[2]}</td><td>${scores[3]}</td><td>${scores[4]}</td><td>${totalScore}</td></tr>`;
                    }
                });
                
                // [변경] Word 출력용 HTML 콘텐츠 (여백 및 서명란 수정)
                const htmlContent = `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>적극행정 우수사례 2차 심사표 집계</title><style>body{font-family:'Malgun Gothic','맑은 고딕',sans-serif;font-size:8pt;margin:1.5cm;padding:0;box-sizing:border-box;}h1,h2{margin:0;padding:0;}.header{text-align:center;}table{width:100%;border-collapse:collapse;margin-bottom:10px;page-break-inside:avoid;}th,td{border:1px solid #000;padding:3px;text-align:center;vertical-align:middle;word-break:break-all;}th{background-color:#f2f2f2;}.main-table th{background-color:#d1e2f7;}.reference-table th{background-color:#e0e0e0;}.reference-table td,.reference-table th{font-size:7pt;vertical-align:middle;}.reference-table ul{text-align:left;margin:0;padding:0 0 0 10px;list-style-type:disc;}</style></head><body><div class="header"><h1 style="font-size:14pt;font-weight:bold;margin-bottom:15px;">적극행정 우수사례 2차 심사표 (개인별)</h1></div><table class="main-table"><thead><tr><th style="width:5%;">연번</th><th style="width:30%;">사례명</th><th style="width:10%;">국민 체감도 (20)</th><th style="width:10%;">적극성<br>및 창의성 (30)</th><th style="width:10%;">중요도 및<br>난이도 (30)</th><th style="width:10%;">확산 가능성 (10)</th><th style="width:10%;">국민 호응도 (10)</th><th style="width:15%;">합계 (100)</th></tr></thead><tbody>${tableHtml}</tbody></table><div style="text-align:right;margin-top:20px;font-size:10pt;"><span style="margin-right:80px;">작성자(심사위원): ${judgeName} (인)</span><span>확인자(위원장): ${chairName} (인)</span></div><div style="margin-top:30px;"><h2 style="font-size:12pt;font-weight:bold;text-align:center;margin-bottom:5px;">심사내용 배점기준표</h2><table class="reference-table"><thead><tr><th style="width:10%;">심사항목</th><th style="width:50%;">심사내용</th><th style="width:5%;">배점</th><th style="width:7%;">매우 우수</th><th style="width:7%;">우수</th><th style="width:7%;">보통</th><th style="width:7%;">미흡</th><th style="width:7%;">매우 미흡</th></tr></thead><tbody><tr><td>국민체감도</td><td style="text-align:left;padding-left:5px;"><ul><li>국민 생활편의 및 만족도를 제고하거나 국가재정 절감에 기여하는 등 국민이 체감할 수 있는 변화 정도를 평가</li></ul></td><td>20</td><td>20-18</td><td>17-14</td><td>13~10</td><td>9~6</td><td>5~</td></tr><tr><td>적극성<br>창의성<br>전문성</td><td style="text-align:left;padding-left:5px;"><ul><li>새로운 정책 발굴, 이해 조정 및 협업 등 문제해결을 위해 적극적으로 노력한 정도를 평가</li><li>해당 과제를 새로운 관점에서 효과적으로 해결하거나 전문지식 경험 등을 활용한 정도를 평가</li></ul></td><td>30</td><td>30-25</td><td>24-19</td><td>18-13</td><td>12-7</td><td>6-</td></tr><tr><td>중요도 및<br>난이도</td><td style="text-align:left;padding-left:5px;"><ul><li>국가 전반의 경쟁력을 제고하는데 도움이 되는 정도</li><li>관련 업무나 민원요구를 해결하기 어려운 정도 또는 열악한 정책 환경 등을 평가</li></ul></td><td>30</td><td>30-25</td><td>24-19</td><td>18-13</td><td>12-7</td><td>6-</td></tr><tr><td>확산 가능성</td><td style="text-align:left;padding-left:5px;"><ul><li>동 사례에서 나타난 적극행정 노력이 타 기관으로 확산될 가능성이 있는지를 평가</li></ul></td><td>10</td><td>10-9</td><td>8-7</td><td>6-5</td><td>4-3</td><td>2-</td></tr></tbody></table><table class="reference-table" style="margin-top:10px;"><thead><tr><th style="width:10%;">심사항목</th><th style="width:50%;">심사내용</th><th style="width:5%;">배점</th><th style="width:7%;">1위</th><th style="width:7%;">2위</th><th style="width:7%;">3위</th><th style="width:7%;">4위</th><th style="width:7%;">5위</th><th style="width:7%;">6위 이하</th></tr></thead><tbody><tr><td>국민호응도</td><td style="text-align:left;padding-left:5px;"><ul><li>온라인 국민투표 결과(1위~6위 이하 순위별 배점)</li></ul></td><td>10</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td></tr></tbody></table></div></body></html>`;

                const blob = new Blob([htmlContent], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = '적극행정_심사표.doc';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // 페이지 로드 시 저장된 데이터 불러오기
            loadData();
        });
    </script>
</body>
</html>
